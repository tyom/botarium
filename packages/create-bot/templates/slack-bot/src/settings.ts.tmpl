import { z } from 'zod'
{{#if isOpenai}}
import { openai } from '@ai-sdk/openai'
{{/if}}
{{#if isAnthropic}}
import { anthropic } from '@ai-sdk/anthropic'
{{/if}}
{{#if isGoogle}}
import { google } from '@ai-sdk/google'
{{/if}}

// Local simulator mode (SLACK_API_URL set)
export const isSimulatorMode = Boolean(process.env.SLACK_API_URL)
const isLocalMode = isSimulatorMode

const envSchema = z.object({
  // Bot Configuration
  BOT_NAME: z.string().default('{{botName}}'),
  BOT_PERSONALITY: z.string().default('Helpful AI assistant'),

  // Slack Configuration (optional in local simulator mode)
  SLACK_BOT_TOKEN: isLocalMode
    ? z.string().default('xoxb-local')
    : z.string().startsWith('xoxb-'),
  SLACK_APP_TOKEN: isLocalMode
    ? z.string().default('xapp-local')
    : z.string().startsWith('xapp-'),
  SLACK_SIGNING_SECRET: isLocalMode
    ? z.string().default('local')
    : z.string().min(1),
{{#if isAi}}

  // AI Provider
  AI_PROVIDER: z.enum(['{{aiProvider}}']).default('{{aiProvider}}'),
{{#if isOpenai}}
  OPENAI_API_KEY: isLocalMode
    ? z.string().default('sk-local')
    : z.string().min(1),
{{/if}}
{{#if isAnthropic}}
  ANTHROPIC_API_KEY: isLocalMode
    ? z.string().default('sk-local')
    : z.string().min(1),
{{/if}}
{{#if isGoogle}}
  GOOGLE_API_KEY: isLocalMode
    ? z.string().default('sk-local')
    : z.string().min(1),
{{/if}}
{{/if}}

  // Server
  PORT: z.coerce.number().default(3000),
  LOG_LEVEL: z.enum(['silent', 'debug', 'info', 'warn', 'error']).default('info'),
})

export type Settings = z.infer<typeof envSchema>

function loadSettings(): Settings {
  const result = envSchema.safeParse(process.env)

  if (!result.success) {
    console.error('Invalid environment configuration:')
    for (const issue of result.error.issues) {
      console.error(`  ${issue.path.join('.')}: ${issue.message}`)
    }
    throw new Error('Failed to load settings. Check your environment variables.')
  }

  return result.data
}

export const settings = loadSettings()
{{#if isAi}}

// AI Model helper
export function getModel() {
{{#if isOpenai}}
  return openai('gpt-5.2')
{{/if}}
{{#if isAnthropic}}
  return anthropic('claude-sonnet-4-5')
{{/if}}
{{#if isGoogle}}
  return google('gemini-3-flash')
{{/if}}
}
{{/if}}
